#!/bin/bash
export FREESURFER_HOME=/usr/local/freesurfer_6/freesurfer
FSFOLDER_DIR=/DATA/IMAGE_DAY/FS/2_fsresults_gtmseg
PET_INPUT_FOLDER=/DATA/IMAGE_DAY/PET/1_2_pet_nii_flip
PARAM_OUTPUT_FOLDER=/DATA/IMAGE_DAY/PET/2_mri-pet_coreg/param
COREGPET_OUTPUT_FOLDER=/DATA/IMAGE_DAY/PET/2_mri-pet_coreg/coreg_pet

pettype="_apet" #<- "_apet" or "_fpet"
SUBJECTS=( 10005259 10009989 10037162 10039803 10049406 10057135 10060232 10088913 10102989 10121757 10124059 10124129 10124578 10132384 10188394 10193149 10196698 10200186 10221176 10249941 10286623 10292457 10297111 10299193 10348158 10352708 10361430 10384109 10415623 10431593 10436839 10442276 10462256 10463538 10483549 10487611 10495751 10582554 10606607 10614855 10622630 10626719 10636350 10714630 10807974 11009038 11081991 11090072 11205557 11596594 12062753 12327366 12523373 13084011 13151632 13229441 13434919 13885827 14115312 14618455 14661219 16148060 16199695 16435911 17754266 18444377 19273561 19763653 19868387 19979092 20236896 20380616 20472818 20855336 20880046 20940241 21214527 21251526 21444018 21823154 21972094 22785488 22822433 23418642 23512025 23734731 23939149 23999413 24071255 24248606 24392123 24418948 25141885 25439830 25489873 25753790 25755455 25911255 26478319 26547246 26668237 26740502 26758844 26993382 27158865 27173422 27272684 27289497 27391080 27472028 27774995 27791077 27978292 29753413 30200298 30292785 31041524 31228509 31240941 31858227 31858544 31878764 32040043 32062315 32081378 32112474 32114999 32207031 32240317 32344909 32429235 32482243 32489477 32489826 32534360 32551132 32560888 32644421 32647266 32782037 32815867 32822175 32861233 33612225  )


PET_DATES=(200514 190227 191211 170201 170722 180124 200601 161103 210104 181119 180130 171129 191030 200909 181128 180129 201026 170708 170603 200526 180511 200619 200915 200811 170330 180509 201023 180331 191211 191203 170331 201230 201012 170327 200703 200908 200819 200304 200410 181217 170527 180907 170121 200915 181127 200701 191121 161021 200916 210105 200921 190718 191022 190902 161210 190628 210121 181204 190704 180327 191019 181121 190107 190516 170915 180413 200623 180928 191021 200417 200810 200507 181218 200723 181106 190111 200626 191031 200630 200828 210108 180711 170929 200702 170303 170922 180205 190507 181201 200520 190906 200626 200821 200709 191113 200603 200407 190920 161222 180115 180917 181124 170124 161223 170517 200624 170704 190731 170701 170313 171107 170908 170711 180914 190104 200804 200803 200106 210113 191207 191214 200811 210111 200515 201006 200331 200522 200116 210202 201023 200407 200401 200410 200424 200521 200420 200831 200805 200527 200707 200821 200731 200826 210208  )

MRI_DATES=(200514 180124 191121 151211 160818 180118 200603 161111 210104 181123 191129 180115 191030 200909 181128 191210 201026 190115 171121 200526 191211 200619 200914 200720 170202 170506 201017 181005 191211 191203 170331 201215 201026 181025 180907 200828 200819 200304 200410 181217 181127 180905 181129 200928 181121 200627 191125 161025 200922 201223 200921 190713 191022 190902 161216 190628 210121 181220 190806 180327 190916 181121 190104 190521 170911 180413 200619 180928 191007 200417 200810 200506 181218 200723 181106 190111 200713 191031 200626 200828 210112 180711 170913 200702 170303 170922 180205 190507 181115 200422 190906 200626 200821 200709 191118 200603 200407 190920 161222 171215 181019 181109 170124 161223 170517 200624 170704 190731 170803 170316 171123 170913 170725 180814 181220 200819 200729 200102 201231 191108 191128 200730 210111 200511 201006 200331 200522 200119 210202 201023 200307 200318 200410 200424 200622 200420 200831 200805 200527 200707 200824 200731 200826 210114   )
##################################################################################################

source $FREESURFER_HOME/SetUpFreeSurfer.sh
SUBJECTS_DIR=$FSFOLDER_DIR

#1. MRI-PET coregistration
#for idx in ${!SUBJECTS[*]}

	#do
	#subj="r"${SUBJECTS[$idx]}"_"${MRI_DATES[$idx]}
	#subj_pet=${SUBJECTS[$idx]}"_"${PET_DATES[$idx]}$pettype	

	#mri_coreg --s $subj \
	#	  --mov $PET_INPUT_FOLDER/"flip_"$subj_pet.nii \
	#	  --reg $PARAM_OUTPUT_FOLDER/$subj_pet"_coreg2M"${MRI_DATES[$idx]}.reg.lta 

	#mri_vol2vol --mov $PET_INPUT_FOLDER/"flip_"$subj_pet.nii \
	#	    --targ $SUBJECTS_DIR/$subj/mri/brainmask.mgz \
	#	    --reg $PARAM_OUTPUT_FOLDER/$subj_pet"_coreg2M"${MRI_DATES[$idx]}.reg.lta \
	#	    --o $COREGPET_OUTPUT_FOLDER/$subj_pet"_coreg2M"${MRI_DATES[$idx]}.nii		  
#done



#2. Check MRI-PET coregistration
for idx in ${!SUBJECTS[*]}

	do
	subj="r"${SUBJECTS[$idx]}"_"${MRI_DATES[$idx]}
	subj_pet=${SUBJECTS[$idx]}"_"${PET_DATES[$idx]}$pettype	

	cd $PET_INPUT_FOLDER
	tkregisterfv --mov $PET_INPUT_FOLDER/"flip_"$subj_pet.nii \
		     --targ $SUBJECTS_DIR/$subj/mri/brainmask.mgz \
		     --reg $PARAM_OUTPUT_FOLDER/$subj_pet"_coreg2M"${MRI_DATES[$idx]}t.reg.lta \
		     --s /$subj \
		     --surfs 		  
done





